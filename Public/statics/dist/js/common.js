!function(e){e.testLogin=function(i){e.ajax({url:"./index.php?m=Home&c=Login&a=checklogin",dataType:"json",type:"get",success:function(o){"1"==o.status?(e(".myinfoalert-header-content .name").html(o.data.nickname),e(".myinfoalert-header-face").attr("src",o.data.headpic),e(".islogin .face").attr("src",o.data.headpic),e("#login").html(o.data.nickname),e("#nologin").hide(),e("#islogin").show(),i(o.data)):"0"==o.status&&(e("#nologin").show(),e("#islogin").hide())},error:function(){}})},e.getId=function(){var e=window.location.href,i=e.split("id=");return i[1]}}(jQuery),$(function(){var e={ver:!0},i={init:function(){$("#login").on("click",i.showInfo),$("body").on("click",i.hideInfo),$("#reg").off().on("click",i.regShow),$("#log").off().on("click",i.logShow),$("body").on("click","#close",i.closeAlert),$("body").on("click","#img1",i.changePic),$("body").on("click","#img2",i.changePic),$("body").on("click","#getfreemesg",i.getVer),$("body").on("submit",".registerform",i.regSubmit),$(".logout").on("click",i.logOut),$.testLogin(function(){})},logOut:function(){window.location.href="./index.php?m=Home&c=Login&a=logout"},regSubmit:function(){return/^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]{8,}$/.test($(":password[name=password]").val())?/^1[23456789]\d{9}$/.test($(":text[name=mb]").val())?/^.+$/.test($(":text[name=idcode2]").val())?$.ajax({url:"./index.php?m=Home&c=Login&a=register",type:"get",dataType:"json",data:{phone:$(":text[name=mb]").val(),passwd:$(":password[name=password]").val(),verify:$(":text[name=idcode2]").val()},success:function(e){console.log(e.msg),"0"==e.status?$("#error").html("注册成功,请去登陆"):"101"==e.status?$("#error").html("注册失败,请稍后再试"):"102"==e.status?$("#error").html("手机号码输入错误，请重新输入"):"103"==e.status?$("#error").html("该手机账号已被注册过"):"105"==e.status&&$("#error").html("密码不符合规则")},error:function(){}}):$("#error").html("验证码输入错误，请重新输入"):$("#error").html("手机号码输入错误，请重新输入"):$("#error").html("密码至少8位，至少包含数字和字符"),!1},getVer:function(){if(/^1[3456789]\d{9}$/.test($(":text[name=mb]").val()))if(/^.+$/.test($(":text[name=idcode1]").val())){if(e.ver){e.ver=!1;var i=30,o=setInterval(function(){$("#getfreemesg").html(i+"秒后继续"),i--,0===i&&(clearInterval(o),e.ver=!0,$("#getfreemesg").html("免费获取短信")),console.log(i)},1e3);$.ajax({url:"./index.php?m=Home&c=Login&a=yzm",type:"get",dataType:"json",data:{code:$(":text[name=idcode1]").val(),phone:$(":text[name=mb]").val()},success:function(e){console.log(e.msg),"0"==e.status?$("#error").html("验证已发送,请注意查收"):"101"==e.status?$("#error").html("服务器错误,请稍后再试"):"102"==e.status?$("#error").html("验证码输入错误，请重新输入"):"103"==e.status&&$("#error").html("手机号码输入错误，请重新输入")},error:function(e){}})}}else $("#error").html("请输入验证号码");else $("#error").html("手机号码错误")},changePic:function(){$("#img1").attr("src","./index.php?m=Home&c=Login&a=verify")},closeAlert:function(){$(this).parent().parent().remove()},regShow:function(){var e=$('<div class="registeralert" id="registeralert"></div>');e.html('<div class="registeralert-main"><div class="close" id="close"></div><form class="registerform" action="index.html" method="post"><div class="registeralert-main-item"><label for="mb">手&nbsp;&nbsp;机：</label><input type="text" name="mb" value="" id="mb" placeholder="请输入手机号码"></div><div class="registeralert-main-item"><label for="password">密&nbsp;&nbsp;码：</label><input type="password" name="password" value="" id="password" placeholder="密码至少8位，至少包含数字和字符"></div><div class="registeralert-main-item"><label for="idcode">验证码：</label><input type="text" class="idcode1" name="idcode1" value="" id="idcode1" placeholder="请输入右侧字母"><div class="pic"><img src="./index.php?m=Home&c=Login&a=verify" alt="" id="img1" /></div><span class="reflesh"><span class="img" id="img2"></span></span></div><div class="registeralert-main-item"><input type="text" name="idcode2" value="" id="idcode2" placeholder="请输入验证码"><span class="getfreemesg" id="getfreemesg">免费获取短信</span></div><span id="error"></span><div class="registeralert-main-item customstyle1"><!-- <span class="agree">&nbsp;&nbsp;我同意<em><用户协议></em></span> --><span class="login" id="go2login">立即登录</span></div><div class="registeralert-main-item"><input type="submit" name="name" value="注册" id="regsubmit"></div><div class="registeralert-main-item"><a href="javascript:;" class="login-weibo"></a><a href="javascript:;" class="login-qq"></a><a href="javascript:;" class="login-weichat"></a></div></form></div>'),$("body").append(e),$("#go2login").off().on("click",function(){$("#registeralert").remove(),i.logShow()}),$(".login-qq").on("click",i.toLoginQQ),$(".login-weibo").on("click",i.toLoginWeiBo),$(".login-weichat").on("click",i.toLoginWeiChat)},logShow:function(){var e=$('<div class="loginalert" id="loginalert"></div>');e.html('<div class="loginalert-main"><div class="close" id="close"></div><form class="logform" action="index.html" method="post"><div class="loginalert-main-item"><label for="mb">用户名：</label><input type="text" name="mb" value="" id="mb" placeholder="请输入手机号码"></div><div class="loginalert-main-item"><label for="password">密&nbsp;&nbsp;码：</label><input type="password" name="password" value="" id="password" placeholder="请输入密码"></div><span id="error"></span><div class="loginalert-main-item customstyle1"><!-- <span class="remenber">&nbsp;&nbsp;记住我</span> --><span class="register" id="go2reg">立即注册</span><a href="./index.php?m=Home&c=User&a=codeback" class="searchpass">找回密码</a></div><div class="loginalert-main-item"><input type="submit" name="name" value="登陆"></div><div class="loginalert-main-item"><a href="javascript:;" class="login-weibo"></a><a href="javascript:;" class="login-qq"></a><a href="javascript:;" class="login-weichat"></a></div></form></div>'),$("body").append(e),$(".logform").on("submit",i.logSubmit),$("#go2reg").on("click",function(){$("#loginalert").remove(),i.regShow()}),$(".login-qq").on("click",i.toLoginQQ),$(".login-weibo").on("click",i.toLoginWeiBo),$(".login-weichat").on("click",i.toLoginWeiChat)},logSubmit:function(){return $.ajax({url:"./index.php?m=Home&c=Login&a=login",type:"get",dataType:"json",data:{name:$(":text[name=mb]").val(),passwd:$(":password[name=password]").val()},success:function(e){console.log(e.msg),"1"==e.status?($("#loginalert").remove(),console.log("登陆成功"),$.testLogin()):"0"==e.status&&$("#error").html("账号密码输入错误")},error:function(){}}),!1},showInfo:function(e){return $("#myinfoalert").show(),!1},hideInfo:function(){$("#myinfoalert").hide()},toLoginQQ:function(){window.open("./index.php?m=Home&c=Login&a=qqlogin","TencentLogin","width=450,height=320,menubar=0,scrollbars=1, resizable = 1, status = 1, titlebar = 0, toolbar = 0, location = 1 ")},toLoginWeiBo:function(){window.open("./index.php?m=Home&c=Login&a=weibologin","TencentLogin","width=450,height=320,menubar=0,scrollbars=1, resizable = 1, status = 1, titlebar = 0, toolbar = 0, location = 1 ")},toLoginWeiChat:function(){window.open("./index.php?m=Home&c=Login&a=weixinlogin","TencentLogin","width=450,height=520,menubar=0,scrollbars=1, resizable = 1, status = 1, titlebar = 0, toolbar = 0, location = 1 ")}};i.init()});