$(function(){var e={now:0,timer:null,type:0,time:0,pageNum:1,imgUrl:""},t={init:function(){$("#dotList").on("click","li",t.tabBanner),$("#groupByType").on("click","li",t.tabGroupByType),$("#groupByTime").on("click","li",t.tabGroupByTime),$("#imgList").on("mouseover",t.mouseover),$("#imgList").on("mouseout",t.mouseout),$("#newActive").on("click",t.createActive),$(".close").on("click",t.closeAlert),$(".activeType").on("change",t.SelectChange),tabinit(),t.getPage(function(){pageInit(parseInt(e.pageNum),10,function(e){return 0==e?!1:void t.getActiveData(e)})}),$("#file_upload").uploadify({swf:"./Public/statics/js/uploadify/uploadify.swf",uploader:"./Public/statics/js/uploadify/uploadify.php",buttonText:"上传活动图片 建议380*285像素",onUploadSuccess:function(t,i,a){console.log(t,i,a);var n=i.match(/\.\\\/Uploads.+"/)[0];e.imgUrl=n.substring(0,n.length-1)}})},SelectChange:function(){var e=$(this).find("option:selected").val();"0"==e?$(".activeAdress").prop("placeholder","请输入活动地址").removeAttr("disabled","disabled"):$(".activeAdress").prop("placeholder","无需活动地址").val("").attr("disabled","disabled")},closeAlert:function(){$(this).parents(".mask").hide()},tabBanner:function(){clearTimeout(e.timer),e.now=$(this).index();var i=$("#dotList"),a=$("#imgList");i.find("li").removeClass("active"),$(this).addClass("active"),a.find("a").removeClass("active"),a.find("a").eq($(this).index()).addClass("active"),t.autoTab()},autoTab:function(){e.timer=setInterval(function(){var t=$("#dotList"),i=$("#imgList");e.now++,e.now>=t.find("li").length&&(e.now=0),t.find("li").removeClass("active"),t.find("li").eq(e.now).addClass("active"),i.find("a").removeClass("active"),i.find("a").eq(e.now).addClass("active")},3e3)},tabGroupByType:function(){$("#groupByType").find("li").removeClass("active"),$(this).addClass("active"),e.type=$(this).data("type"),t.getPage(function(){pageInit(e.pageNum,10,function(e){t.getActiveData(e)})})},tabGroupByTime:function(){$("#groupByTime").find("li").removeClass("active"),$(this).addClass("active"),e.time=$(this).data("time"),t.getPage(function(){pageInit(e.pageNum,10,function(e){t.getActiveData(e)})})},mouseover:function(){clearTimeout(e.timer)},mouseout:function(){t.autoTab()},createActive:function(){$("#mask").show()},getPage:function(t){$.ajax({url:"./index.php?m=Home&c=Active&a=activetype",type:"get",dataType:"json",data:{type:e.type,time:e.time,p:1},success:function(i){e.pageNum=i.data.page,t()},error:function(){}})},getActiveData:function(t){$.ajax({url:"./index.php?m=Home&c=Active&a=activetype",type:"get",dataType:"json",data:{type:e.type,time:e.time,p:t},success:function(e){var t=e.data.data,i="";if(0==e.data.page)return $("#itemlist").html(i),!1;for(var a=0,n=t.length;n>a;a++)i+='<li><a href="./index.php?m=Home&c=Active&a=active_details&id='+t[a].id+'"><img src="./Uploads'+t[a].img+'"><div class="tags"><h3>'+t[a].title+"</h3><p>"+t[a].begin_time+"-"+t[a].last_time+'</p></div><sub></sub></a><div class="desc"><span class="txt">'+t[a].content+'</span><div><span class="num">'+t[a].concern+'</span><i class="focus"></i></div></div></li>';$("#itemlist").html(i)},error:function(){}})}};t.init()});